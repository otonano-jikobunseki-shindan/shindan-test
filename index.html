<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="robots" content="noindex,nofollow" />
  <title>開き方のご案内</title>

  <!-- ② ブラウザUI非表示に“寄せる”設定（※通常表示では完全には消えません） -->
  <meta name="theme-color" content="#ffd6e8" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    :root{
      /* ② 透明ボタン（仮）ズレたらここだけ調整 */
      --cta-left: 15%;
      --cta-top:  69%;
      --cta-w:    70%;
      --cta-h:    10%;

      /* ① 緑帯（index-top.webp 1239x2048 から算出） */
      --band-top:    23.6%;
      --band-height: 7.3%;
      --marquee-speed: 28s;

      /* ① フェード強さ（上下どれだけ透明にするか） */
      --fade-edge: 7%; /* 5〜10%くらいで調整 */
    }

    *{ box-sizing:border-box; }

    html, body{
      margin:0;
      padding:0;
      height:100%;
      background:#0000;
      overscroll-behavior: none;
    }

    body{
      /* 画面いっぱいで使う（新しいvh単位も併用） */
      min-height: 100vh;
      min-height: 100svh;
      min-height: 100dvh;
    }

    /* ===== 背景（index-back.webp）フルスクリーン ===== */
    .bg-full{
      position: fixed;
      inset: 0;
      background: url("assets/illust/index-back.webp") center center / cover no-repeat;
      z-index: 0;
    }

    /* ===== 手前（index-top.webp） ===== */
    .stage{
      position: relative;
      z-index: 1;
      width: 100vw;
      height: 100vh;
      height: 100svh;
      height: 100dvh;
      overflow: hidden;
    }

    /* index-top.webp は左右余白なしで横幅に合わせる（高さは比率維持） */
    .stage img.top{
      position:absolute;
      left:0;
      top:0;
      width:100vw;
      height:auto;
      display:block;
      user-select:none;
      -webkit-user-drag:none;

      /* ① 上下をフェードして背景に馴染ませる（Safari対策で -webkit- も付ける） */
      -webkit-mask-image: linear-gradient(
        to bottom,
        transparent 0%,
        #000 var(--fade-edge),
        #000 calc(100% - var(--fade-edge)),
        transparent 100%
      );
      mask-image: linear-gradient(
        to bottom,
        transparent 0%,
        #000 var(--fade-edge),
        #000 calc(100% - var(--fade-edge)),
        transparent 100%
      );
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      -webkit-mask-size: 100% 100%;
      mask-size: 100% 100%;
    }

    /* ===== ① 緑帯の無限スクロール ===== */
    .band{
      position:absolute;
      left:0;
      top: var(--band-top);
      width:100%;
      height: var(--band-height);
      overflow:hidden;
      pointer-events:none; /* 帯は触れない */
    }

    .track{
      height:100%;
      display:flex;
      flex-wrap:nowrap;
      gap:0;
      align-items:stretch;
      width:max-content;
      animation: marqueeLeft var(--marquee-speed) linear infinite;
      will-change: transform;
    }

    .track img{
      height:100%;
      width:auto;
      display:block; /* 隙間対策 */
    }

    @keyframes marqueeLeft{
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* ===== ② 透明ボタン ===== */
    .cta{
      position:absolute;
      left: var(--cta-left);
      top:  var(--cta-top);
      width: var(--cta-w);
      height: var(--cta-h);

      background: transparent;
      border:0;
      padding:0;
      cursor:pointer;

      /* 押しやすさ */
      min-height: 44px;
      touch-action: manipulation;
    }

    /* トースト（既存機能） */
    .toast{
      position:fixed;
      left:50%;
      bottom:16px;
      transform:translateX(-50%);
      background: rgba(255,255,255,0.92);
      color:#222;
      border:1px solid rgba(0,0,0,0.08);
      border-radius:12px;
      padding:10px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      display:none;
      font-size:13px;
      z-index: 9999;
    }
  </style>
</head>

<body>
  <div class="bg-full" aria-hidden="true"></div>

  <script>
    // ★毎回ここだけ更新：Gemini共有URL（ベース）
    const TARGET_URL_BASE = "https://otonano-jikobunseki-shindan.github.io/shindan-test/quiz.html";

    // index.html に付いている ?from=... や ?invite=... を quiz.html へ引き継ぐ
    const TARGET_URL = (() => {
      const u = new URL(TARGET_URL_BASE);
      // index側のクエリを丸ごと引き継ぐ（先頭の ? を含む）
      u.search = location.search || "";
      return u.toString();
    })();

    const ua = navigator.userAgent || "";

    const isMobile = /Android|iPhone|iPad|iPod/i.test(ua);
    const isIOS = /iPhone|iPad|iPod/i.test(ua);
    const isAndroid = /Android/i.test(ua);

    const isInAppStrong =
      /Line\//i.test(ua) ||
      /;\s*wv\)/i.test(ua) ||
      /Version\/4\.0/i.test(ua);

    const isSafari =
      isIOS &&
      /Safari/i.test(ua) &&
      !/CriOS|FxiOS|EdgiOS|OPiOS|GSA|Line\//i.test(ua);

    const isChromeIOS = isIOS && /CriOS/i.test(ua);

    const isChromeAndroid =
      isAndroid &&
      /Chrome\/|Chromium\//i.test(ua) &&
      !/Edg|OPR|SamsungBrowser/i.test(ua) &&
      !isInAppStrong;

    const allowOnMobile = (isSafari || isChromeIOS || isChromeAndroid);

    function toast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(window.__t);
      window.__t = setTimeout(()=> el.style.display="none", 1700);
    }

    function makeChromeIntent(url){
      const u = new URL(url);
      const fallback = encodeURIComponent(url);
      return `intent://${u.host}${u.pathname}${u.search}#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=${fallback};end`;
    }

    async function copyLink(){
      try{
        await navigator.clipboard.writeText(TARGET_URL);
        toast("リンクをコピーしました！");
      }catch(e){
        const ta=document.createElement("textarea");
        ta.value=TARGET_URL; document.body.appendChild(ta);
        ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
        toast("リンクをコピーしました！");
      }
    }

    function openExternal(){
      if (isAndroid) {
        location.href = makeChromeIntent(TARGET_URL);
        return;
      }
      window.open(TARGET_URL, "_blank", "noopener,noreferrer");
    }

    if (!isMobile) {
      location.replace(TARGET_URL);
    } else if (allowOnMobile) {
      location.replace(TARGET_URL);
    } else {
      window.__APP__ = { openExternal, copyLink };
    }
  </script>

  <div class="stage" aria-label="案内画面">
    <img class="top" src="assets/illust/index-top.webp" alt="開き方のご案内">

    <!-- ① 緑帯：1〜40を隙間なしで無限スクロール -->
    <div class="band" aria-hidden="true">
      <div class="track">
        <!-- 1周目 -->
        <img src="assets/illust/1.png" alt=""><img src="assets/illust/2.png" alt=""><img src="assets/illust/3.png" alt=""><img src="assets/illust/4.png" alt=""><img src="assets/illust/5.png" alt="">
        <img src="assets/illust/6.png" alt=""><img src="assets/illust/7.png" alt=""><img src="assets/illust/8.png" alt=""><img src="assets/illust/9.png" alt=""><img src="assets/illust/10.png" alt="">
        <img src="assets/illust/11.png" alt=""><img src="assets/illust/12.png" alt=""><img src="assets/illust/13.png" alt=""><img src="assets/illust/14.png" alt=""><img src="assets/illust/15.png" alt="">
        <img src="assets/illust/16.png" alt=""><img src="assets/illust/17.png" alt=""><img src="assets/illust/18.png" alt=""><img src="assets/illust/19.png" alt=""><img src="assets/illust/20.png" alt="">
        <img src="assets/illust/21.png" alt=""><img src="assets/illust/22.png" alt=""><img src="assets/illust/23.png" alt=""><img src="assets/illust/24.png" alt=""><img src="assets/illust/25.png" alt="">
        <img src="assets/illust/26.png" alt=""><img src="assets/illust/27.png" alt=""><img src="assets/illust/28.png" alt=""><img src="assets/illust/29.png" alt=""><img src="assets/illust/30.png" alt="">
        <img src="assets/illust/31.png" alt=""><img src="assets/illust/32.png" alt=""><img src="assets/illust/33.png" alt=""><img src="assets/illust/34.png" alt=""><img src="assets/illust/35.png" alt="">
        <img src="assets/illust/36.png" alt=""><img src="assets/illust/37.png" alt=""><img src="assets/illust/38.png" alt=""><img src="assets/illust/39.png" alt=""><img src="assets/illust/40.png" alt="">

        <!-- 2周目（同じ並びをもう1回） -->
        <img src="assets/illust/1.png" alt=""><img src="assets/illust/2.png" alt=""><img src="assets/illust/3.png" alt=""><img src="assets/illust/4.png" alt=""><img src="assets/illust/5.png" alt="">
        <img src="assets/illust/6.png" alt=""><img src="assets/illust/7.png" alt=""><img src="assets/illust/8.png" alt=""><img src="assets/illust/9.png" alt=""><img src="assets/illust/10.png" alt="">
        <img src="assets/illust/11.png" alt=""><img src="assets/illust/12.png" alt=""><img src="assets/illust/13.png" alt=""><img src="assets/illust/14.png" alt=""><img src="assets/illust/15.png" alt="">
        <img src="assets/illust/16.png" alt=""><img src="assets/illust/17.png" alt=""><img src="assets/illust/18.png" alt=""><img src="assets/illust/19.png" alt=""><img src="assets/illust/20.png" alt="">
        <img src="assets/illust/21.png" alt=""><img src="assets/illust/22.png" alt=""><img src="assets/illust/23.png" alt=""><img src="assets/illust/24.png" alt=""><img src="assets/illust/25.png" alt="">
        <img src="assets/illust/26.png" alt=""><img src="assets/illust/27.png" alt=""><img src="assets/illust/28.png" alt=""><img src="assets/illust/29.png" alt=""><img src="assets/illust/30.png" alt="">
        <img src="assets/illust/31.png" alt=""><img src="assets/illust/32.png" alt=""><img src="assets/illust/33.png" alt=""><img src="assets/illust/34.png" alt=""><img src="assets/illust/35.png" alt="">
        <img src="assets/illust/36.png" alt=""><img src="assets/illust/37.png" alt=""><img src="assets/illust/38.png" alt=""><img src="assets/illust/39.png" alt=""><img src="assets/illust/40.png" alt="">
      </div>
    </div>

    <!-- ② 透明ボタン：既存ボタンと同じ機能（openExternal） -->
    <button class="cta" type="button" onclick="__APP__.openExternal()" aria-label="診断スタート"></button>
  </div>

  <div class="toast" id="toast"></div>
</body>
</html>
