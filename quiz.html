<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>大人の診断テスト</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --muted:#93a4c7; --text:#eaf0ff;
      --accent:#7c3aed; --accent2:#22c55e; --danger:#ef4444; --line:#243055;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;background:linear-gradient(180deg,#0b1020,#070a14);color:var(--text);}
    a{color:inherit}
    .wrap{max-width:760px;margin:0 auto;padding:18px 14px 40px;}
    .hero{padding:18px 16px;border:1px solid var(--line);border-radius:16px;background:rgba(18,26,51,.72);backdrop-filter: blur(8px);}
    h1{font-size:22px;margin:0 0 8px;}
    .sub{color:var(--muted);line-height:1.6;margin:0}
    .card{margin-top:14px;padding:16px;border:1px solid var(--line);border-radius:16px;background:rgba(18,26,51,.72);}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--line);background:#0f1733;color:var(--text);
      padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer;flex:1;min-width:140px;
    }
    .btn:hover{border-color:#3b4a7a}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#4f46e5);border-color:transparent;}
    .btn.good{background:linear-gradient(90deg,var(--accent2),#16a34a);border-color:transparent;}
    .btn.ghost{background:transparent}
    .btn.danger{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.35);}
    .label{font-size:12px;color:var(--muted);margin:0 0 8px}
    .progress{height:10px;background:#0a0f22;border:1px solid var(--line);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#22c55e);transition:width .25s}
    .qtitle{font-size:16px;font-weight:800;margin:0 0 10px;line-height:1.5}
    .opt{display:block;width:100%;text-align:left;margin:10px 0;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:#0f1733;color:var(--text);cursor:pointer}
    .opt:hover{border-color:#3b4a7a}
    .tiny{font-size:12px;color:var(--muted);line-height:1.6}
    .field{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0f1733;color:var(--text);font-size:16px}
    select.field{appearance:auto;}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .pill{display:inline-block;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:12px}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .err{color:#fecaca;background:rgba(239,68,68,.10);border:1px solid rgba(239,68,68,.35);padding:10px;border-radius:12px;margin-top:10px}
    .ok{color:#bbf7d0;background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.35);padding:10px;border-radius:12px;margin-top:10px}
    .mutedBox{border:1px dashed var(--line);border-radius:12px;padding:10px;color:var(--muted);line-height:1.7}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <h1>あなたの特性が笑っちゃうほどわかる！大人の診断テスト！</h1>
      <p class="sub">5分以内で回答できる！現在、完全無料で診断できます。</p>
      <p class="sub tiny">※このページはスマホ前提で作っていますが、PCでも表示可能です。</p>
    </div>

    <div id="app" class="card"></div>

    <div class="card">
      <div class="label">デバッグ表示（必要なときだけ見る用）</div>
      <div class="mutedBox tiny">
        sessionId: <span id="dbgSid" class="mono"></span><br/>
        step: <span id="dbgStep" class="mono"></span>
      </div>
    </div>
  </div>

<script>
/* =========================
   設定
========================= */
const GAS_URL = "https://script.google.com/macros/s/AKfycbz0nSbcIZKV6P3d8NPu1mZKRjVLT2EF6grR5nfc2otxiky6jdaRBiFhskvjoemWUlOn/exec";
const NEXT_PAGE_URL = "result.html";

const ACTIONS = { LOG: "logAnswer" };

const TSV_PATH = {
  male: "data/male_questions.tsv",
  female: "data/female_questions.tsv",
  mbti: "data/mbti_options.tsv"
};

const LS = {
  gender: "diag_gender",
  sid: "diag_sid",
  answers: "diag_answers",
  progress: "diag_progress"
};

let runtime = {
  step: "landing",
  sid: "",
  gender: "",
  questions: [],
  idx: 0,
  answers: {},
  mbtiOptions: null,
};

const $app = document.getElementById("app");
const $dbgSid = document.getElementById("dbgSid");
const $dbgStep = document.getElementById("dbgStep");

/* =========================
   ユーティリティ
========================= */
function setStep(step){ runtime.step = step; render(); }
function escapeHTML(s){
  return String(s ?? "")
    .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;").replace(/'/g,"&#39;");
}
function nowISO(){ return new Date().toISOString(); }
function newSessionId(){
  if (crypto?.randomUUID) return crypto.randomUUID();
  return "sid_" + Date.now() + "_" + Math.random().toString(16).slice(2);
}

function loadLS(){
  const sid = localStorage.getItem(LS.sid);
  const gender = localStorage.getItem(LS.gender);
  const answersRaw = localStorage.getItem(LS.answers);
  const progressRaw = localStorage.getItem(LS.progress);

  if (sid) runtime.sid = sid;
  if (gender) runtime.gender = gender;

  if (answersRaw){
    try{ runtime.answers = JSON.parse(answersRaw) || {}; }catch(_){}
  }
  if (progressRaw){
    try{
      const p = JSON.parse(progressRaw) || {};
      runtime.idx = Number(p.idx || 0);
    }catch(_){}
  }
}

function saveLS(){
  localStorage.setItem(LS.sid, runtime.sid);
  localStorage.setItem(LS.gender, runtime.gender);
  localStorage.setItem(LS.answers, JSON.stringify(runtime.answers || {}));
  localStorage.setItem(LS.progress, JSON.stringify({ idx: runtime.idx, savedAt: nowISO() }));
}

// 元の全消し
function clearLSForRestart(){
  localStorage.removeItem(LS.gender);
  localStorage.removeItem(LS.sid);
  localStorage.removeItem(LS.answers);
  localStorage.removeItem(LS.progress);
}

// ★追加：genderだけ残す全消し（③）
function clearLSForRestartKeepGender(){
  localStorage.removeItem(LS.sid);
  localStorage.removeItem(LS.answers);
  localStorage.removeItem(LS.progress);
}

async function loadTSV(path){
  const res = await fetch(path, { cache:"no-store" });
  if (!res.ok) throw new Error(`TSV読込に失敗: ${path}`);
  const text = await res.text();
  return parseTSV(text);
}

function parseTSV(tsv){
  const lines = tsv.replace(/\r/g,"").split("\n").filter(l => l.trim() !== "");
  if (lines.length < 2) return [];
  const rawHeader = lines[0].split("\t").map(s=>s.trim());
  const header = rawHeader.map((h, i) => h !== "" ? h : `__col${i}`);

  const rows = [];
  for (let i=1;i<lines.length;i++){
    const cols = lines[i].split("\t");
    const obj = {};
    for (let c=0;c<header.length;c++){
      obj[header[c]] = (cols[c] ?? "").trim();
    }
    rows.push(obj);
  }
  return rows;
}

function optStr(n){ return "OPT" + String(n); }

async function postGAS(payload){
  const res = await fetch(GAS_URL, {
    method:"POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });
  const text = await res.text();
  let json;
  try{ json = JSON.parse(text); }catch(_){ throw new Error("GAS応答がJSONではありません"); }
  return json;
}

function handoffToNextPage(){
  const sid = encodeURIComponent(runtime.sid || "");
  const gender = encodeURIComponent(runtime.gender || "");
  const url = `${NEXT_PAGE_URL}?sid=${sid}&gender=${gender}`;
  location.replace(url);
}

/* =========================
   MBTI options
========================= */
function normalizeMbtiType(type){
  const t = String(type || "").toUpperCase().replace(/[^EISNTFJP]/g,"");
  return (t.length === 4) ? t : "";
}
function inferMbtiAxesFromType(type){
  const t = normalizeMbtiType(type);
  if (!t) return {MBTI1:"",MBTI2:"",MBTI3:"",MBTI4:""};
  return {MBTI1:t[0], MBTI2:t[1], MBTI3:t[2], MBTI4:t[3]};
}

async function loadMbtiOptions(){
  const rows = await loadTSV(TSV_PATH.mbti);
  const opts = [];

  for (const r of rows){
    const label = (r["表示名"] || r["表示"] || r["Label"] || r["__col0"] || "").trim();
    if (!label) continue;

    const m = label.match(/^([EI][SN][TF][JP])/i);
    if (!m) continue;
    const type = normalizeMbtiType(m[1]);
    if (!type) continue;

    const axes = {
      MBTI1: (r.MBTI1 || "").trim(),
      MBTI2: (r.MBTI2 || "").trim(),
      MBTI3: (r.MBTI3 || "").trim(),
      MBTI4: (r.MBTI4 || "").trim(),
    };
    const inferred = inferMbtiAxesFromType(type);

    opts.push({
      label,
      type,
      MBTI1: axes.MBTI1 || inferred.MBTI1,
      MBTI2: axes.MBTI2 || inferred.MBTI2,
      MBTI3: axes.MBTI3 || inferred.MBTI3,
      MBTI4: axes.MBTI4 || inferred.MBTI4,
    });
  }

  const seen = new Set();
  const uniq = [];
  for (const o of opts){
    if (seen.has(o.type)) continue;
    seen.add(o.type);
    uniq.push(o);
  }
  return uniq;
}

/* =========================
   初期化
========================= */
async function init(){
  loadLS();
  if (!runtime.sid) runtime.sid = newSessionId();
  runtime.step = "landing";
  render();
}
init();

/* =========================
   画面：レンダリング
========================= */
function render(){
  $dbgSid.textContent = runtime.sid || "";
  $dbgStep.textContent = runtime.step || "";

  if (runtime.step === "landing") return renderLanding();
  if (runtime.step === "gender") return renderGender();
  if (runtime.step === "quiz") return renderQuiz();
  if (runtime.step === "mbti") return renderMbti();
  if (runtime.step === "handoff") return renderHandoff();
}

function renderLanding(){
  const hasProgress = !!(runtime.gender && (runtime.idx > 0 || Object.keys(runtime.answers||{}).length > 0));

  $app.innerHTML = `
    <div class="label">まずはスタート</div>
    <p class="sub">いくつかの質問に答えるだけで、あなたの傾向をスパッと整理します。</p>
    <div class="hr"></div>

    ${hasProgress ? `
      <div class="mutedBox tiny" style="margin-bottom:10px;">
        途中保存データが見つかりました。続きから再開できます。
      </div>
      <div class="row">
        <button class="btn primary" id="btnResume">続きから再開</button>
        <button class="btn danger" id="btnNewStart">最初から</button>
      </div>
    ` : `
      <button class="btn primary" id="btnStart">診断をはじめる</button>
    `}

    <p class="tiny" style="margin-top:10px;">
      ※このページ（quiz.html）は「回答送信→次ページへ引き継ぎ」まで担当します。<br/>
      ※結果の表示は次のページで行ってください。
    </p>
  `;

  if (!hasProgress){
    document.getElementById("btnStart").onclick = () => setStep("gender");
    return;
  }

  document.getElementById("btnResume").onclick = async () => {
    try{
      runtime.questions = await loadTSV(runtime.gender === "male" ? TSV_PATH.male : TSV_PATH.female);
      setStep("quiz");
    }catch(err){
      $app.innerHTML = `<div class="err">TSV読込エラー: ${escapeHTML(err.message)}</div>
        <div class="hr"></div>
        <button class="btn ghost" id="back">戻る</button>`;
      document.getElementById("back").onclick = () => setStep("landing");
    }
  };

  // ★③：genderは残す / Q1に戻せるようにする
  document.getElementById("btnNewStart").onclick = () => {
    if (!confirm("保存データを破棄して最初からにしますか？")) return;

    const keepGender = runtime.gender || localStorage.getItem(LS.gender) || "";

    runtime.sid = newSessionId();
    runtime.gender = keepGender;
    runtime.idx = 0;
    runtime.answers = {};
    runtime.mbtiOptions = null;

    clearLSForRestartKeepGender();
    saveLS();

    if (runtime.gender){
      (async () => {
        try{
          runtime.questions = await loadTSV(runtime.gender === "male" ? TSV_PATH.male : TSV_PATH.female);
          setStep("quiz");
        }catch(_){
          setStep("gender");
        }
      })();
    }else{
      setStep("gender");
    }
  };
}

function renderGender(){
  $app.innerHTML = `
    <div class="label">質問 0 / 性別</div>
    <p class="qtitle">あなたはどれですか？</p>
    <div class="row">
      <button class="btn" id="gMale">男性</button>
      <button class="btn" id="gFemale">女性</button>
      <button class="btn" id="gOther">その他</button>
    </div>
    <p class="tiny" style="margin-top:10px;">
      ※「その他」は女性と同じ質問に進みます。<br/>
      ※それ以外の目的で性別を使用しません。
    </p>
    <div class="hr"></div>
    <button class="btn ghost" id="back">戻る</button>
  `;

  document.getElementById("gMale").onclick = () => startQuizWithGender("male");
  document.getElementById("gFemale").onclick = () => startQuizWithGender("female");
  document.getElementById("gOther").onclick = () => startQuizWithGender("female");

  document.getElementById("back").onclick = () => setStep("landing");
}

async function startQuizWithGender(gender){
  runtime.gender = gender;
  runtime.idx = 0;
  runtime.answers = {};
  runtime.questions = [];
  runtime.mbtiOptions = null;

  // 新規開始はsid作り直す（混線防止）
  runtime.sid = newSessionId();
  saveLS();

  try{
    runtime.questions = await loadTSV(gender === "male" ? TSV_PATH.male : TSV_PATH.female);
  }catch(err){
    $app.innerHTML = `<div class="err">TSV読込エラー: ${escapeHTML(err.message)}</div>
      <div class="hr"></div>
      <button class="btn ghost" id="back">戻る</button>`;
    document.getElementById("back").onclick = () => setStep("gender");
    return;
  }

  setStep("quiz");
}

function renderQuiz(){
  const qTotal = runtime.questions.length || 0;
  const idx = runtime.idx;

  if (!qTotal){
    $app.innerHTML = `
      <div class="err">質問データが空です。TSVの中身を確認してください。</div>
      <div class="hr"></div>
      <button class="btn ghost" id="back">性別選択に戻る</button>
    `;
    document.getElementById("back").onclick = () => setStep("gender");
    return;
  }

  if (idx >= qTotal){
    $app.innerHTML = `
      <div class="label">回答完了（Q1〜Q${qTotal}）</div>
      <p class="qtitle">おつかれ！最後にMBTI（任意）を聞いて、次へ進みます。</p>
      <button class="btn good" id="btnToMbti">MBTI入力へ進む</button>
      <p class="tiny" style="margin-top:10px;">
        ※MBTIは未入力でもOKです。
      </p>
    `;
    document.getElementById("btnToMbti").onclick = () => setStep("mbti");
    return;
  }

  const q = runtime.questions[idx];
  const qid = q.QID || q.qid || `Q${idx+1}`;
  const text = q["質問文"] || q["question"] || q["Question"] || q["質問"] || "";

  const opts = [];

  // ★②：選択肢は上から「番号が大きい順」＝10→1
  for (let i=10;i>=1;i--){
    const key = `選択肢${i}`;
    if (q[key] != null && String(q[key]).trim() !== "") opts.push({ label: String(q[key]).trim(), opt: optStr(i) });
  }
  if (!opts.length){
    for (let i=10;i>=1;i--){
      const key = `OPT${i}`;
      if (q[key] != null && String(q[key]).trim() !== "") opts.push({ label: String(q[key]).trim(), opt: optStr(i) });
    }
  }

  const answered = runtime.answers[qid];
  const pct = Math.round((idx / qTotal) * 100);

  $app.innerHTML = `
    <div class="row" style="justify-content:space-between;align-items:center;">
      <span class="pill">進捗 ${idx+1} / ${qTotal}</span>
      <span class="pill">性別: ${runtime.gender === "male" ? "男性" : "女性/その他"}</span>
    </div>

    <div class="progress" style="margin-top:10px;">
      <div class="bar" style="width:${pct}%"></div>
    </div>

    <div class="hr"></div>

    <div class="label">${escapeHTML(qid)}</div>
    <p class="qtitle">${escapeHTML(text)}</p>

    <div id="optArea">
      ${opts.map(o => `
        <button class="opt" data-opt="${escapeHTML(o.opt)}">
          ${escapeHTML(o.label)}
          ${answered === o.opt ? ' <span class="pill" style="float:right;">選択中</span>' : ''}
        </button>
      `).join("")}
    </div>

    <div class="row" style="margin-top:10px;">
      <button class="btn ghost" id="btnPrev" ${idx===0?'disabled':''}>戻る</button>
      <button class="btn danger" id="btnRestart">最初からやり直す</button>
    </div>

    <p class="tiny" style="margin-top:10px;">
      ※回答は進むたびに保存されます（ブラウザ更新でも戻れます）。<br/>
      ※通信が弱いときでもローカル保存は残ります。
    </p>

    <div id="msg"></div>
  `;

  document.querySelectorAll("#optArea .opt").forEach(btn=>{
    btn.onclick = async () => {
      const opt = btn.getAttribute("data-opt");
      await answerQuestion(qid, opt);
    };
  });

  document.getElementById("btnPrev").onclick = () => {
    runtime.idx = Math.max(0, runtime.idx - 1);
    saveLS();
    render();
  };

  // ★③：genderは残す / Q1に戻る
  document.getElementById("btnRestart").onclick = async () => {
    if (!confirm("最初からやり直しますか？")) return;

    const keepGender = runtime.gender;

    runtime.sid = newSessionId();
    runtime.gender = keepGender;
    runtime.idx = 0;
    runtime.answers = {};
    runtime.mbtiOptions = null;

    clearLSForRestartKeepGender();
    saveLS();

    try{
      runtime.questions = await loadTSV(runtime.gender === "male" ? TSV_PATH.male : TSV_PATH.female);
      setStep("quiz");
    }catch(_){
      setStep("gender");
    }
  };
}

async function answerQuestion(qid, opt){
  runtime.answers[qid] = opt;
  saveLS();

  const msg = document.getElementById("msg");
  msg.innerHTML = `<div class="tiny">保存中…</div>`;

  try{
    const payload = {
      action: ACTIONS.LOG,
      sessionId: runtime.sid,
      gender: runtime.gender,
      qid,
      opt,
      answeredAt: nowISO()
    };
    const r = await postGAS(payload);
    msg.innerHTML = r?.ok
      ? `<div class="ok tiny">保存OK</div>`
      : `<div class="tiny">（保存はローカルのみで継続中）</div>`;
  }catch(_){
    msg.innerHTML = `<div class="tiny">（通信が不安定なので、ローカル保存のまま継続します）</div>`;
  }

  runtime.idx += 1;
  saveLS();
  render();
}

/* =========================
   MBTI step（任意）
========================= */
function renderMbti(){
  $app.innerHTML = `
    <div class="label">MBTI（任意）</div>
    <p class="qtitle">もし分かれば、MBTIを選んでください（未選択でもOK）。</p>

    <div id="mbtiArea">
      <div class="tiny">候補を読み込み中…</div>
    </div>

    <div class="hr"></div>

    <div class="row">
      <button class="btn ghost" id="btnBackToQuiz">回答を見直す</button>
      <button class="btn good" id="btnNext">送信して次へ</button>
    </div>

    <div id="msg"></div>

    <p class="tiny" style="margin-top:10px;">
      ※プルダウン表示は「ENFP（運動家）」形式です。<br/>
      ※選択すると MBTI1〜4（E/I, S/N, T/F, J/P）も一緒に保存・送信します。
    </p>
  `;

  document.getElementById("btnBackToQuiz").onclick = () => {
    runtime.idx = Math.max(0, (runtime.questions?.length || 1) - 1);
    saveLS();
    setStep("quiz");
  };

  document.getElementById("btnNext").onclick = async () => {
    await saveMbtiAndHandoff();
  };

  (async () => {
    const area = document.getElementById("mbtiArea");
    try{
      if (!runtime.mbtiOptions) runtime.mbtiOptions = await loadMbtiOptions();

      if (!runtime.mbtiOptions || runtime.mbtiOptions.length === 0){
        area.innerHTML = `<div class="err">mbti_options.tsv は読めましたが、候補が0件でした。</div>
          <div class="tiny">（TSVの1列目に「ENFP（運動家）」形式が入っているか確認してください）</div>`;
        return;
      }

      const savedType = normalizeMbtiType(runtime.answers.MBTI || "");
      area.innerHTML = `
        <div class="label">MBTIタイプ</div>
        <select id="mbtiSelect" class="field">
          <option value="">選択しない（分からない）</option>
          ${runtime.mbtiOptions.map(o => `
            <option value="${escapeHTML(o.type)}" ${o.type === savedType ? "selected" : ""}>
              ${escapeHTML(o.label)}
            </option>
          `).join("")}
        </select>
        <div class="tiny" style="margin-top:10px;">
          ※表示は「ENFP（運動家）」、送信は「MBTI=ENFP / MBTI1..4=E N F P」です。
        </div>
      `;
    }catch(err){
      area.innerHTML = `<div class="err">MBTI候補の読込に失敗: ${escapeHTML(err.message)}</div>
        <div class="tiny">※一旦スキップして次へ進めます。</div>`;
    }
  })();
}

async function saveMbtiAndHandoff(){
  const msg = document.getElementById("msg");
  msg.innerHTML = `<div class="tiny">送信準備中…</div>`;

  const sel = document.getElementById("mbtiSelect");
  const type = sel ? normalizeMbtiType(sel.value) : "";

  if (type){
    const found = (runtime.mbtiOptions || []).find(o => o.type === type);
    const axes = found ? {
      MBTI1: found.MBTI1 || "",
      MBTI2: found.MBTI2 || "",
      MBTI3: found.MBTI3 || "",
      MBTI4: found.MBTI4 || "",
    } : inferMbtiAxesFromType(type);

    runtime.answers.MBTI = type;
    runtime.answers.MBTI1 = axes.MBTI1;
    runtime.answers.MBTI2 = axes.MBTI2;
    runtime.answers.MBTI3 = axes.MBTI3;
    runtime.answers.MBTI4 = axes.MBTI4;
    saveLS();

    try{
      const r = await postGAS({
        action: ACTIONS.LOG,
        sessionId: runtime.sid,
        gender: runtime.gender,
        qid: "MBTI",
        opt: type,
        MBTI1: axes.MBTI1,
        MBTI2: axes.MBTI2,
        MBTI3: axes.MBTI3,
        MBTI4: axes.MBTI4,
        answeredAt: nowISO()
      });

      msg.innerHTML = r?.ok
        ? `<div class="ok">MBTIも送信しました。次ページへ移動します。</div>`
        : `<div class="tiny">（MBTIの送信はローカル保存のみで継続）次ページへ移動します。</div>`;
    }catch(_){
      msg.innerHTML = `<div class="tiny">（通信が不安定なのでMBTIはローカル保存のみ）次ページへ移動します。</div>`;
    }
  }else{
    msg.innerHTML = `<div class="tiny">MBTIは未選択のまま次へ進みます。</div>`;
  }

  setTimeout(() => setStep("handoff"), 350);
}

function renderHandoff(){
  $app.innerHTML = `
    <div class="label">送信完了</div>
    <p class="qtitle">次のページへ移動します。</p>
    <div class="mutedBox tiny">
      sessionId を引き継いでいます：<span class="mono">${escapeHTML(runtime.sid)}</span>
    </div>
    <div class="hr"></div>
    <button class="btn primary" id="go">次へ</button>
  `;
  document.getElementById("go").onclick = () => handoffToNextPage();
  setTimeout(() => handoffToNextPage(), 500);
}
</script>
</body>
</html>
